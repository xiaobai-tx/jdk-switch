# JDK Switch Tool

一个简单的命令行工具，用于在Windows系统中快速切换不同版本的JDK。

> **特别说明**：本项目95%以上的代码由Cursor AI辅助工具生成

## 设计理念

本项目与SDKMan、jabba等工具不同，不提供自动下载和安装JDK的功能，而是专注于环境变量的快速切换。这是因为：

- SDKMan等工具在下载JDK时常常会遇到网络问题，尤其在中国大陆地区
- 许多开发者已经手动下载并安装了多个版本的JDK
- 本工具假设用户已经安装了所需的JDK版本，只需进行环境变量的切换
- 通过仅专注于环境变量管理，工具更加轻量级和高效

简而言之，本工具的核心功能是通过修改系统环境变量，在已安装的JDK版本之间进行快速切换，而不是管理JDK的下载和安装。

> **技术选择说明**：虽然使用批处理脚本（.bat）或PowerShell脚本实现此功能可能更简单直接，但本项目选择使用Go语言开发，主要是作为学习和练习Go编程的实践项目。Go语言提供了跨平台能力、更好的错误处理和更丰富的功能扩展性，尽管对于此类任务可能有些"过度设计"。

## 功能特性

- 支持多个JDK版本之间的快速切换
- 自动配置JAVA_HOME、PATH和CLASSPATH环境变量
- 自动备份环境变量，确保操作安全
- 智能清理PATH中的冗余Java条目
- 保存当前使用的JDK版本
- 支持配置文件管理JDK路径
- 配置文件独立于项目，方便分发和使用
- 支持命令行和交互式操作
- 提供详细的性能统计信息
- 检测并提示Oracle Java路径问题

## 命令行参数

```
用法: jdk-switch [命令]

命令:
  -init      初始化配置文件
  -list      列出所有可用的JDK版本
  -set <版本> 切换到指定的JDK版本
  -backup    仅备份当前环境变量，不切换JDK版本
  -v         显示版本信息
  -h         显示帮助信息

不带参数运行将启动交互模式
```

## 使用方法

1. 首次使用时，初始化配置文件：
```bash
jdk-switch.exe -init
```
这将在 `C:\jdk-switch\config.json` 创建默认配置文件。

2. 根据你的实际JDK安装路径，修改配置文件：
```json
{
    "jdk_paths": {
        "8": "C:\\Program Files\\Java\\jdk1.8.0_301",
        "11": "C:\\Program Files\\Java\\jdk-11.0.12",
        "17": "C:\\Program Files\\Java\\jdk-17.0.2"
    },
    "current_version": "8"
}
```

3. 查看可用的JDK版本：
```bash
jdk-switch.exe -list
```

4. 切换到指定的JDK版本：
```bash
jdk-switch.exe -set 11
```

5. 或者使用交互模式：
```bash
jdk-switch.exe
```
然后根据提示输入要切换的JDK版本号。

6. 备份当前环境变量（也可作为单独功能使用）：
```bash
jdk-switch.exe -backup
```

## 环境变量设置

工具会自动设置以下环境变量：

1. **JAVA_HOME** - 设置为选定的JDK安装路径
2. **PATH** - 添加JDK的bin目录并移除其他Java相关路径
3. **CLASSPATH** - 设置为包含当前目录(.)和JDK lib目录下的常用JAR文件

## 环境变量备份

工具在每次修改环境变量前会自动创建备份，备份文件保存在：
```
C:\jdk-switch\backup\年月日_时分秒\
```

每个备份目录包含以下文件：
- PATH.txt - PATH环境变量的备份
- JAVA_HOME.txt - JAVA_HOME环境变量的备份
- CLASSPATH.txt - CLASSPATH环境变量的备份
- backup_info.txt - 备份信息摘要

## 性能监控

工具会显示各个操作步骤的执行时间，帮助识别潜在的性能瓶颈：

```
备份环境变量耗时: 123ms
读取环境变量耗时: 45ms
修改环境变量耗时: 67ms
广播环境变量变更耗时: 890ms
总耗时: 1.125s
```

注意：广播环境变量变更通常是最耗时的操作，这是正常现象。

## 常见问题解决

1. **环境变量未生效**
   - 尝试重启命令提示符或PowerShell
   - 确认是否有权限修改系统环境变量

2. **Oracle Java路径问题**
   - 如果提示存在Oracle Java路径问题，按照提示删除PATH中的Oracle路径
   - 或临时重命名该目录: `C:\Program Files\Common Files\Oracle\Java\javapath`

3. **操作耗时较长**
   - 检查性能数据以确定瓶颈所在
   - 如果PATH环境变量非常长，可能会影响处理速度

## 配置文件位置

配置文件默认保存在：`C:\jdk-switch\config.json`

## 注意事项

- 需要以管理员权限运行程序
- 目前只支持Windows系统
- 确保配置文件中的JDK路径正确存在
- 修改环境变量后可能需要重启终端才能生效
- 工具会自动管理PATH环境变量中的Java相关条目
- 操作前会自动备份环境变量，无需担心误操作

## 构建

```bash
# 开发版本构建
go build -o jdk-switch.exe

# 发布版本构建（减小文件体积）
go build -ldflags="-s -w" -o jdk-switch.exe
```

## 系统要求

- Windows操作系统
- Go 1.20或更高版本（仅构建需要）
- 管理员权限（用于修改系统环境变量）

## 免责声明

**⚠️ 重要提示：使用风险自负**

本工具会修改系统环境变量，尽管我们已尽力确保其安全性并添加了自动备份功能，但仍可能存在风险。如果在使用本工具后出现以下情况，开发者不承担任何责任：

- 环境变量设置错误导致的系统问题
- Java应用程序无法正常工作
- PATH或其他环境变量被意外修改或删除
- 任何其他由环境变量更改导致的系统异常

请在使用前备份您的环境变量（本工具会自动执行此操作），并确保您知道如何在出现问题时手动恢复环境变量。如果您不确定如何操作，请不要使用本工具。

**记住：工具仅作为便利提供，出现问题请自行负责。**

## 许可证

本项目采用 MIT 许可证进行开源。详情请参阅项目根目录中的 [LICENSE](LICENSE) 文件。 